<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Orden de Trabajo - LENSOR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e2e8f0;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            display: inline-block;
        }

        .title {
            font-size: 1.8rem;
            color: var(--dark);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .subtitle {
            color: var(--secondary);
            font-size: 1rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .card-body {
            padding: 25px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .input-wrapper {
            position: relative;
        }

        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--light);
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 14px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn i {
            margin-right: 8px;
        }

        .spinner {
            display: none;
            margin: 20px auto;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(37, 99, 235, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            display: none;
            text-align: center;
            padding: 15px;
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 500;
        }

        .success-message i {
            margin-right: 8px;
        }

        .balance-container {
            background: rgba(245, 158, 11, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .balance-container.visible {
            display: block;
        }

        .balance-title {
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
        }

        .required::after {
            content: " *";
            color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo">LENSOR</div>
            <h1 class="title">Orden de Trabajo</h1>
            <p class="subtitle">Complete el formulario para generar la orden en PDF</p>
        </div>

        <div class="card">
            <div class="card-header">
                <i class="fas fa-clipboard-list"></i> Información de la Orden
            </div>
            <div class="card-body">
                <form id="workOrderForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cliente" class="required">Nombre del Cliente</label>
                            <div class="input-wrapper">
                                <input type="text" id="cliente" name="cliente" required>
                                <i class="fas fa-user input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="telefono" class="required">Número de Teléfono</label>
                            <div class="input-wrapper">
                                <input type="tel" id="telefono" name="telefono" required>
                                <i class="fas fa-phone input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="direccion" class="required">Dirección</label>
                            <div class="input-wrapper">
                                <input type="text" id="direccion" name="direccion" required>
                                <i class="fas fa-map-marker-alt input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="descripcion" class="required">Descripción de Producto o Servicio</label>
                            <div class="input-wrapper">
                                <input type="text" id="descripcion" name="descripcion" required>
                                <i class="fas fa-tools input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="tecnico" class="required">Nombre del Técnico</label>
                            <div class="input-wrapper">
                                <input type="text" id="tecnico" name="tecnico" required>
                                <i class="fas fa-hard-hat input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="fecha_solicitud" class="required">Fecha de Solicitud</label>
                            <input type="date" id="fecha_solicitud" name="fecha_solicitud" required>
                        </div>

                        <div class="form-group">
                            <label for="fecha" class="required">Fecha de Entrega</label>
                            <input type="date" id="fecha" name="fecha" required>
                        </div>

                        <div class="form-group">
                            <label for="precio" class="required">Precio Final (GTQ)</label>
                            <div class="input-wrapper">
                                <input type="number" id="precio" name="precio" step="0.01" required>
                                <i class="fas fa-dollar-sign input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="adelanto">Adelanto (GTQ)</label>
                            <div class="input-wrapper">
                                <input type="number" id="adelanto" name="adelanto" step="0.01">
                                <i class="fas fa-hand-holding-usd input-icon"></i>
                            </div>
                            
                            <div class="balance-container" id="balanceContainer">
                                <div class="balance-title">Saldo pendiente:</div>
                                <div class="balance-amount" id="balanceAmount">Q0.00</div>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="comentarios">Comentarios Adicionales</label>
                            <textarea id="comentarios" name="comentarios" rows="4"></textarea>
                        </div>
                    </div>

                    <button type="submit" class="btn">
                        <i class="fas fa-file-pdf"></i> Generar PDF
                    </button>

                    <!-- Spinner de carga -->
                    <div class="spinner" id="spinner"></div>

                    <!-- Mensaje de éxito -->
                    <div class="success-message" id="successMessage">
                        <i class="fas fa-check-circle"></i> PDF generado con éxito
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Calcular saldo pendiente automáticamente
        function calcularSaldo() {
            const precio = parseFloat(document.getElementById('precio').value) || 0;
            const adelanto = parseFloat(document.getElementById('adelanto').value) || 0;
            
            if (precio > 0 && adelanto > 0) {
                const saldo = precio - adelanto;
                document.getElementById('balanceAmount').textContent = `Q${saldo.toFixed(2)}`;
                document.getElementById('balanceContainer').classList.add('visible');
            } else {
                document.getElementById('balanceContainer').classList.remove('visible');
            }
        }

        // Agregar event listeners para calcular el saldo automáticamente
        document.getElementById('precio').addEventListener('input', calcularSaldo);
        document.getElementById('adelanto').addEventListener('input', calcularSaldo);

        document.getElementById('workOrderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Mostrar el spinner de carga
            document.getElementById('spinner').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';

            // Simulación de una pequeña pausa para ver la animación
            setTimeout(function() {
                const cliente = document.getElementById('cliente').value;
                const telefono = document.getElementById('telefono').value;
                const direccion = document.getElementById('direccion').value;
                const descripcion = document.getElementById('descripcion').value;
                const tecnico = document.getElementById('tecnico').value;
                const fechaSolicitud = document.getElementById('fecha_solicitud').value;
                const fechaEntrega = document.getElementById('fecha').value;
                const adelanto = document.getElementById('adelanto').value || "No especificado"; 
                const precio = document.getElementById('precio').value || "No especificado"; 
                const comentarios = document.getElementById('comentarios').value;

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configuración de colores
                const primaryColor = [37, 99, 235];
                const lightColor = [248, 250, 252];
                const darkColor = [30, 41, 59];
                
                // Encabezado con diseño moderno
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 220, 30, 'F');
                
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 255, 255);
                doc.text("LENSOR", 105, 17, null, null, "center");
                
                // Información de la empresa
                doc.setFontSize(9);
                doc.setTextColor(...darkColor);
                doc.text("Dirección: 6Ta Avenida 6-92, Z1 Escuintla, Escuintla.", 105, 35, null, null, "center");
                doc.text("Teléfono: +502 5871-0789", 105, 40, null, null, "center");
                
                // Título del documento
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...primaryColor);
                doc.text("ORDEN DE TRABAJO", 105, 55, null, null, "center");
                
                // Línea decorativa
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(0.5);
                doc.line(50, 58, 160, 58);
                
                // Fecha de generación
                const today = new Date();
                const formattedDate = today.toLocaleDateString('es-GT');
                doc.setFontSize(10);
                doc.setTextColor(...darkColor);
                doc.text(`Generado: ${formattedDate}`, 180, 15, null, null, "right");
                
                // Datos del cliente en formato de tarjeta moderna
                doc.setFillColor(...lightColor);
                doc.roundedRect(20, 65, 170, 40, 3, 3, 'F');
                doc.setDrawColor(200, 200, 200);
                doc.roundedRect(20, 65, 170, 40, 3, 3, 'S');
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...primaryColor);
                doc.text("INFORMACIÓN DEL CLIENTE", 30, 75);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...darkColor);
                doc.text(`Nombre: ${cliente}`, 30, 82);
                doc.text(`Teléfono: ${telefono}`, 30, 89);
                doc.text(`Dirección: ${direccion}`, 30, 96);
                
                // Detalles de la orden en formato de tabla moderna
                const startY = 115;
                
                // Encabezado de la tabla
                doc.setFillColor(...primaryColor);
                doc.roundedRect(20, startY, 170, 10, 3, 3, 'F');
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(255, 255, 255);
                doc.text("DESCRIPCIÓN", 40, startY + 7);
                doc.text("DETALLE", 130, startY + 7);
                
                // Filas de la tabla
                const tableData = [
                    ["Producto/Servicio", descripcion],
                    ["Técnico asignado", tecnico],
                    ["Fecha de solicitud", fechaSolicitud],
                    ["Fecha de entrega", fechaEntrega],
                    ["Precio final (GTQ)", `Q${precio}`],
                    ["Adelanto (GTQ)", adelanto !== "No especificado" ? `Q${adelanto}` : adelanto],
                    ["Comentarios", comentarios]
                ];
                
                let currentY = startY + 10;
                
                tableData.forEach((row, i) => {
                    // Filas alternas con colores
                    if (i % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                    } else {
                        doc.setFillColor(255, 255, 255);
                    }
                    
                    doc.rect(20, currentY, 170, 10, 'F');
                    doc.setDrawColor(220, 220, 220);
                    doc.line(20, currentY, 190, currentY);
                    
                    doc.setFontSize(10);
                    doc.setTextColor(...darkColor);
                    
                    // Primera columna en negrita
                    doc.setFont('helvetica', 'bold');
                    doc.text(row[0], 25, currentY + 7);
                    
                    // Segunda columna normal
                    doc.setFont('helvetica', 'normal');
                    
                    // Manejar texto largo con ajuste de línea
                    const maxWidth = 80;
                    const lines = doc.splitTextToSize(row[1], maxWidth);
                    
                    if (lines.length > 1) {
                        doc.text(lines, 130, currentY + 7);
                        currentY += (lines.length - 1) * 5;
                    } else {
                        doc.text(row[1], 130, currentY + 7);
                    }
                    
                    currentY += 10;
                });
                
                // Información de pago
                const paymentY = currentY + 10;
                doc.setFillColor(...lightColor);
                doc.roundedRect(20, paymentY, 170, 20, 3, 3, 'F');
                doc.setDrawColor(200, 200, 200);
                doc.roundedRect(20, paymentY, 170, 20, 3, 3, 'S');
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...primaryColor);
                doc.text("INFORMACIÓN DE PAGO", 30, paymentY + 8);
                
                const saldo = adelanto !== "No especificado" && precio !== "No especificado" ? 
                    `Q${(parseFloat(precio) - parseFloat(adelanto)).toFixed(2)}` : "No especificado";
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...darkColor);
                doc.text(`Saldo pendiente: ${saldo}`, 30, paymentY + 15);
                
                // Firma
                const signatureY = paymentY + 35;
                doc.setDrawColor(150, 150, 150);
                doc.line(50, signatureY, 160, signatureY);
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text("Firma del Cliente", 105, signatureY + 10, null, null, "center");
                
                // Pie de página
                const footerY = 270;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text("Cualquier adelanto o abono aquí dado, no tiene devolución alguna", 105, footerY, null, null, "center");
                
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(0.3);
                doc.line(50, footerY + 3, 160, footerY + 3);
                
                // Número de página
                doc.text(`Página 1 de 1`, 105, footerY + 10, null, null, "center");
                
                // Nombre del archivo como "Nombre del cliente_Fecha de entrega.pdf"
                const fileName = `${cliente}_${fechaEntrega}.pdf`;
                doc.save(fileName);

                // Ocultar el spinner de carga y mostrar mensaje de éxito
                document.getElementById('spinner').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';

                // Limpiar el formulario después de generar el PDF
                setTimeout(function() {
                    document.getElementById('workOrderForm').reset();
                    document.getElementById('successMessage').style.display = 'none';
                    document.getElementById('balanceContainer').classList.remove('visible');
                }, 3000);

            }, 1000); // Simulación de espera
        });

        // Establecer fecha actual como valor por defecto en los campos de fecha
        window.addEventListener('DOMContentLoaded', (event) => {
            const today = new Date();
            const formattedDate = today.toISOString().substr(0, 10);
            document.getElementById('fecha_solicitud').value = formattedDate;
            
            // Establecer fecha de entrega por defecto a 7 días después
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 7);
            const formattedNextWeek = nextWeek.toISOString().substr(0, 10);
            document.getElementById('fecha').value = formattedNextWeek;
        });
    </script>
</body>
</html>